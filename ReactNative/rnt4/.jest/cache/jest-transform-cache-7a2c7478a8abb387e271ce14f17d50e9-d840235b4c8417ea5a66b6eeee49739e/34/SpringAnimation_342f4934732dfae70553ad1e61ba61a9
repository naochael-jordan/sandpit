e1b9f06113642f3b88894700220d287e

'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

var _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if ("value" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var AnimatedValue = require('../nodes/AnimatedValue');
var AnimatedValueXY = require('../nodes/AnimatedValueXY');
var Animation = require('./Animation');
var SpringConfig = require('../SpringConfig');

var invariant = require('fbjs/lib/invariant');

var _require = require('../NativeAnimatedHelper'),
    shouldUseNativeDriver = _require.shouldUseNativeDriver;

function withDefault(value, defaultValue) {
  if (value === undefined || value === null) {
    return defaultValue;
  }
  return value;
}

var SpringAnimation = function (_Animation) {
  _inherits(SpringAnimation, _Animation);

  function SpringAnimation(config) {
    _classCallCheck(this, SpringAnimation);

    var _this = _possibleConstructorReturn(this, (SpringAnimation.__proto__ || Object.getPrototypeOf(SpringAnimation)).call(this));

    _this._overshootClamping = withDefault(config.overshootClamping, false);
    _this._restDisplacementThreshold = withDefault(config.restDisplacementThreshold, 0.001);
    _this._restSpeedThreshold = withDefault(config.restSpeedThreshold, 0.001);
    _this._initialVelocity = withDefault(config.velocity, 0);
    _this._lastVelocity = withDefault(config.velocity, 0);
    _this._toValue = config.toValue;
    _this._delay = withDefault(config.delay, 0);
    _this._useNativeDriver = shouldUseNativeDriver(config);
    _this.__isInteraction = config.isInteraction !== undefined ? config.isInteraction : true;
    _this.__iterations = config.iterations !== undefined ? config.iterations : 1;

    if (config.stiffness !== undefined || config.damping !== undefined || config.mass !== undefined) {
      invariant(config.bounciness === undefined && config.speed === undefined && config.tension === undefined && config.friction === undefined, 'You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one');
      _this._stiffness = withDefault(config.stiffness, 100);
      _this._damping = withDefault(config.damping, 10);
      _this._mass = withDefault(config.mass, 1);
    } else if (config.bounciness !== undefined || config.speed !== undefined) {
      invariant(config.tension === undefined && config.friction === undefined && config.stiffness === undefined && config.damping === undefined && config.mass === undefined, 'You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one');
      var springConfig = SpringConfig.fromBouncinessAndSpeed(withDefault(config.bounciness, 8), withDefault(config.speed, 12));
      _this._stiffness = springConfig.stiffness;
      _this._damping = springConfig.damping;
      _this._mass = 1;
    } else {
      var _springConfig = SpringConfig.fromOrigamiTensionAndFriction(withDefault(config.tension, 40), withDefault(config.friction, 7));
      _this._stiffness = _springConfig.stiffness;
      _this._damping = _springConfig.damping;
      _this._mass = 1;
    }

    invariant(_this._stiffness > 0, 'Stiffness value must be greater than 0');
    invariant(_this._damping > 0, 'Damping value must be greater than 0');
    invariant(_this._mass > 0, 'Mass value must be greater than 0');
    return _this;
  }

  _createClass(SpringAnimation, [{
    key: '__getNativeAnimationConfig',
    value: function __getNativeAnimationConfig() {
      return {
        type: 'spring',
        overshootClamping: this._overshootClamping,
        restDisplacementThreshold: this._restDisplacementThreshold,
        restSpeedThreshold: this._restSpeedThreshold,
        stiffness: this._stiffness,
        damping: this._damping,
        mass: this._mass,
        initialVelocity: withDefault(this._initialVelocity, this._lastVelocity),
        toValue: this._toValue,
        iterations: this.__iterations
      };
    }
  }, {
    key: 'start',
    value: function start(fromValue, onUpdate, onEnd, previousAnimation, animatedValue) {
      var _this2 = this;

      this.__active = true;
      this._startPosition = fromValue;
      this._lastPosition = this._startPosition;

      this._onUpdate = onUpdate;
      this.__onEnd = onEnd;
      this._lastTime = Date.now();
      this._frameTime = 0.0;

      if (previousAnimation instanceof SpringAnimation) {
        var internalState = previousAnimation.getInternalState();
        this._lastPosition = internalState.lastPosition;
        this._lastVelocity = internalState.lastVelocity;

        this._initialVelocity = this._lastVelocity;
        this._lastTime = internalState.lastTime;
      }

      var start = function start() {
        if (_this2._useNativeDriver) {
          _this2.__startNativeAnimation(animatedValue);
        } else {
          _this2.onUpdate();
        }
      };

      if (this._delay) {
        this._timeout = setTimeout(start, this._delay);
      } else {
        start();
      }
    }
  }, {
    key: 'getInternalState',
    value: function getInternalState() {
      return {
        lastPosition: this._lastPosition,
        lastVelocity: this._lastVelocity,
        lastTime: this._lastTime
      };
    }
  }, {
    key: 'onUpdate',
    value: function onUpdate() {
      var MAX_STEPS = 64;
      var now = Date.now();
      if (now > this._lastTime + MAX_STEPS) {
        now = this._lastTime + MAX_STEPS;
      }

      var deltaTime = (now - this._lastTime) / 1000;
      this._frameTime += deltaTime;

      var c = this._damping;
      var m = this._mass;
      var k = this._stiffness;
      var v0 = -this._initialVelocity;

      var zeta = c / (2 * Math.sqrt(k * m));
      var omega0 = Math.sqrt(k / m);
      var omega1 = omega0 * Math.sqrt(1.0 - zeta * zeta);
      var x0 = this._toValue - this._startPosition;

      var position = 0.0;
      var velocity = 0.0;
      var t = this._frameTime;
      if (zeta < 1) {
        var envelope = Math.exp(-zeta * omega0 * t);
        position = this._toValue - envelope * ((v0 + zeta * omega0 * x0) / omega1 * Math.sin(omega1 * t) + x0 * Math.cos(omega1 * t));

        velocity = zeta * omega0 * envelope * (Math.sin(omega1 * t) * (v0 + zeta * omega0 * x0) / omega1 + x0 * Math.cos(omega1 * t)) - envelope * (Math.cos(omega1 * t) * (v0 + zeta * omega0 * x0) - omega1 * x0 * Math.sin(omega1 * t));
      } else {
        var _envelope = Math.exp(-omega0 * t);
        position = this._toValue - _envelope * (x0 + (v0 + omega0 * x0) * t);
        velocity = _envelope * (v0 * (t * omega0 - 1) + t * x0 * (omega0 * omega0));
      }

      this._lastTime = now;
      this._lastPosition = position;
      this._lastVelocity = velocity;

      this._onUpdate(position);
      if (!this.__active) {
        return;
      }

      var isOvershooting = false;
      if (this._overshootClamping && this._stiffness !== 0) {
        if (this._startPosition < this._toValue) {
          isOvershooting = position > this._toValue;
        } else {
          isOvershooting = position < this._toValue;
        }
      }
      var isVelocity = Math.abs(velocity) <= this._restSpeedThreshold;
      var isDisplacement = true;
      if (this._stiffness !== 0) {
        isDisplacement = Math.abs(this._toValue - position) <= this._restDisplacementThreshold;
      }

      if (isOvershooting || isVelocity && isDisplacement) {
        if (this._stiffness !== 0) {
          this._lastPosition = this._toValue;
          this._lastVelocity = 0;
          this._onUpdate(this._toValue);
        }

        this.__debouncedOnEnd({ finished: true });
        return;
      }
      this._animationFrame = requestAnimationFrame(this.onUpdate.bind(this));
    }
  }, {
    key: 'stop',
    value: function stop() {
      _get(SpringAnimation.prototype.__proto__ || Object.getPrototypeOf(SpringAnimation.prototype), 'stop', this).call(this);
      this.__active = false;
      clearTimeout(this._timeout);
      global.cancelAnimationFrame(this._animationFrame);
      this.__debouncedOnEnd({ finished: false });
    }
  }]);

  return SpringAnimation;
}(Animation);

module.exports = SpringAnimation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlNwcmluZ0FuaW1hdGlvbi5qcyJdLCJuYW1lcyI6WyJBbmltYXRlZFZhbHVlIiwicmVxdWlyZSIsIkFuaW1hdGVkVmFsdWVYWSIsIkFuaW1hdGlvbiIsIlNwcmluZ0NvbmZpZyIsImludmFyaWFudCIsInNob3VsZFVzZU5hdGl2ZURyaXZlciIsIndpdGhEZWZhdWx0IiwidmFsdWUiLCJkZWZhdWx0VmFsdWUiLCJ1bmRlZmluZWQiLCJTcHJpbmdBbmltYXRpb24iLCJjb25maWciLCJfb3ZlcnNob290Q2xhbXBpbmciLCJvdmVyc2hvb3RDbGFtcGluZyIsIl9yZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkIiwicmVzdERpc3BsYWNlbWVudFRocmVzaG9sZCIsIl9yZXN0U3BlZWRUaHJlc2hvbGQiLCJyZXN0U3BlZWRUaHJlc2hvbGQiLCJfaW5pdGlhbFZlbG9jaXR5IiwidmVsb2NpdHkiLCJfbGFzdFZlbG9jaXR5IiwiX3RvVmFsdWUiLCJ0b1ZhbHVlIiwiX2RlbGF5IiwiZGVsYXkiLCJfdXNlTmF0aXZlRHJpdmVyIiwiX19pc0ludGVyYWN0aW9uIiwiaXNJbnRlcmFjdGlvbiIsIl9faXRlcmF0aW9ucyIsIml0ZXJhdGlvbnMiLCJzdGlmZm5lc3MiLCJkYW1waW5nIiwibWFzcyIsImJvdW5jaW5lc3MiLCJzcGVlZCIsInRlbnNpb24iLCJmcmljdGlvbiIsIl9zdGlmZm5lc3MiLCJfZGFtcGluZyIsIl9tYXNzIiwic3ByaW5nQ29uZmlnIiwiZnJvbUJvdW5jaW5lc3NBbmRTcGVlZCIsImZyb21PcmlnYW1pVGVuc2lvbkFuZEZyaWN0aW9uIiwidHlwZSIsImluaXRpYWxWZWxvY2l0eSIsImZyb21WYWx1ZSIsIm9uVXBkYXRlIiwib25FbmQiLCJwcmV2aW91c0FuaW1hdGlvbiIsImFuaW1hdGVkVmFsdWUiLCJfX2FjdGl2ZSIsIl9zdGFydFBvc2l0aW9uIiwiX2xhc3RQb3NpdGlvbiIsIl9vblVwZGF0ZSIsIl9fb25FbmQiLCJfbGFzdFRpbWUiLCJEYXRlIiwibm93IiwiX2ZyYW1lVGltZSIsImludGVybmFsU3RhdGUiLCJnZXRJbnRlcm5hbFN0YXRlIiwibGFzdFBvc2l0aW9uIiwibGFzdFZlbG9jaXR5IiwibGFzdFRpbWUiLCJzdGFydCIsIl9fc3RhcnROYXRpdmVBbmltYXRpb24iLCJfdGltZW91dCIsInNldFRpbWVvdXQiLCJNQVhfU1RFUFMiLCJkZWx0YVRpbWUiLCJjIiwibSIsImsiLCJ2MCIsInpldGEiLCJNYXRoIiwic3FydCIsIm9tZWdhMCIsIm9tZWdhMSIsIngwIiwicG9zaXRpb24iLCJ0IiwiZW52ZWxvcGUiLCJleHAiLCJzaW4iLCJjb3MiLCJpc092ZXJzaG9vdGluZyIsImlzVmVsb2NpdHkiLCJhYnMiLCJpc0Rpc3BsYWNlbWVudCIsIl9fZGVib3VuY2VkT25FbmQiLCJmaW5pc2hlZCIsIl9hbmltYXRpb25GcmFtZSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImJpbmQiLCJjbGVhclRpbWVvdXQiLCJnbG9iYWwiLCJjYW5jZWxBbmltYXRpb25GcmFtZSIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7QUFTQTs7Ozs7Ozs7Ozs7O0FBRUEsSUFBTUEsZ0JBQWdCQyxRQUFRLHdCQUFSLENBQXRCO0FBQ0EsSUFBTUMsa0JBQWtCRCxRQUFRLDBCQUFSLENBQXhCO0FBQ0EsSUFBTUUsWUFBWUYsUUFBUSxhQUFSLENBQWxCO0FBQ0EsSUFBTUcsZUFBZUgsUUFBUSxpQkFBUixDQUFyQjs7QUFFQSxJQUFNSSxZQUFZSixRQUFRLG9CQUFSLENBQWxCOztlQUNnQ0EsUUFBUSx5QkFBUixDO0lBQXpCSyxxQixZQUFBQSxxQjs7QUFvQ1AsU0FBU0MsV0FBVCxDQUF3QkMsS0FBeEIsRUFBbUNDLFlBQW5DLEVBQXVEO0FBQ3JELE1BQUlELFVBQVVFLFNBQVYsSUFBdUJGLFVBQVUsSUFBckMsRUFBMkM7QUFDekMsV0FBT0MsWUFBUDtBQUNEO0FBQ0QsU0FBT0QsS0FBUDtBQUNEOztJQUVLRyxlOzs7QUFzQkosMkJBQVlDLE1BQVosRUFBaUQ7QUFBQTs7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OztBQUVELGFBQUtxRSxnQkFBTCxDQUFzQixFQUFDQyxVQUFVLElBQVgsRUFBdEI7QUFDQTtBQUNEO0FBQ0QsV0FBS0MsZUFBTCxHQUF1QkMsc0JBQXNCLEtBQUsvQyxRQUFMLENBQWNnRCxJQUFkLENBQW1CLElBQW5CLENBQXRCLENBQXZCO0FBQ0Q7OzsyQkFFWTtBQUNYO0FBQ0EsV0FBSzVDLFFBQUwsR0FBZ0IsS0FBaEI7QUFDQTZDLG1CQUFhLEtBQUs3QixRQUFsQjtBQUNBOEIsYUFBT0Msb0JBQVAsQ0FBNEIsS0FBS0wsZUFBakM7QUFDQSxXQUFLRixnQkFBTCxDQUFzQixFQUFDQyxVQUFVLEtBQVgsRUFBdEI7QUFDRDs7OztFQW5SMkJ6RixTOztBQXNSOUJnRyxPQUFPQyxPQUFQLEdBQWlCekYsZUFBakIiLCJmaWxlIjoiU3ByaW5nQW5pbWF0aW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqXG4gKiBUaGlzIHNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSBmb3VuZCBpbiB0aGVcbiAqIExJQ0VOU0UgZmlsZSBpbiB0aGUgcm9vdCBkaXJlY3Rvcnkgb2YgdGhpcyBzb3VyY2UgdHJlZS5cbiAqXG4gKiBAZmxvd1xuICogQGZvcm1hdFxuICovXG4ndXNlIHN0cmljdCc7XG5cbmNvbnN0IEFuaW1hdGVkVmFsdWUgPSByZXF1aXJlKCcuLi9ub2Rlcy9BbmltYXRlZFZhbHVlJyk7XG5jb25zdCBBbmltYXRlZFZhbHVlWFkgPSByZXF1aXJlKCcuLi9ub2Rlcy9BbmltYXRlZFZhbHVlWFknKTtcbmNvbnN0IEFuaW1hdGlvbiA9IHJlcXVpcmUoJy4vQW5pbWF0aW9uJyk7XG5jb25zdCBTcHJpbmdDb25maWcgPSByZXF1aXJlKCcuLi9TcHJpbmdDb25maWcnKTtcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnZmJqcy9saWIvaW52YXJpYW50Jyk7XG5jb25zdCB7c2hvdWxkVXNlTmF0aXZlRHJpdmVyfSA9IHJlcXVpcmUoJy4uL05hdGl2ZUFuaW1hdGVkSGVscGVyJyk7XG5cbmltcG9ydCB0eXBlIHtBbmltYXRpb25Db25maWcsIEVuZENhbGxiYWNrfSBmcm9tICcuL0FuaW1hdGlvbic7XG5cbmV4cG9ydCB0eXBlIFNwcmluZ0FuaW1hdGlvbkNvbmZpZyA9IEFuaW1hdGlvbkNvbmZpZyAmIHtcbiAgdG9WYWx1ZTogbnVtYmVyIHwgQW5pbWF0ZWRWYWx1ZSB8IHt4OiBudW1iZXIsIHk6IG51bWJlcn0gfCBBbmltYXRlZFZhbHVlWFksXG4gIG92ZXJzaG9vdENsYW1waW5nPzogYm9vbGVhbixcbiAgcmVzdERpc3BsYWNlbWVudFRocmVzaG9sZD86IG51bWJlcixcbiAgcmVzdFNwZWVkVGhyZXNob2xkPzogbnVtYmVyLFxuICB2ZWxvY2l0eT86IG51bWJlciB8IHt4OiBudW1iZXIsIHk6IG51bWJlcn0sXG4gIGJvdW5jaW5lc3M/OiBudW1iZXIsXG4gIHNwZWVkPzogbnVtYmVyLFxuICB0ZW5zaW9uPzogbnVtYmVyLFxuICBmcmljdGlvbj86IG51bWJlcixcbiAgc3RpZmZuZXNzPzogbnVtYmVyLFxuICBkYW1waW5nPzogbnVtYmVyLFxuICBtYXNzPzogbnVtYmVyLFxuICBkZWxheT86IG51bWJlcixcbn07XG5cbmV4cG9ydCB0eXBlIFNwcmluZ0FuaW1hdGlvbkNvbmZpZ1NpbmdsZSA9IEFuaW1hdGlvbkNvbmZpZyAmIHtcbiAgdG9WYWx1ZTogbnVtYmVyIHwgQW5pbWF0ZWRWYWx1ZSxcbiAgb3ZlcnNob290Q2xhbXBpbmc/OiBib29sZWFuLFxuICByZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkPzogbnVtYmVyLFxuICByZXN0U3BlZWRUaHJlc2hvbGQ/OiBudW1iZXIsXG4gIHZlbG9jaXR5PzogbnVtYmVyLFxuICBib3VuY2luZXNzPzogbnVtYmVyLFxuICBzcGVlZD86IG51bWJlcixcbiAgdGVuc2lvbj86IG51bWJlcixcbiAgZnJpY3Rpb24/OiBudW1iZXIsXG4gIHN0aWZmbmVzcz86IG51bWJlcixcbiAgZGFtcGluZz86IG51bWJlcixcbiAgbWFzcz86IG51bWJlcixcbiAgZGVsYXk/OiBudW1iZXIsXG59O1xuXG5mdW5jdGlvbiB3aXRoRGVmYXVsdDxUPih2YWx1ZTogP1QsIGRlZmF1bHRWYWx1ZTogVCk6IFQge1xuICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCB8fCB2YWx1ZSA9PT0gbnVsbCkge1xuICAgIHJldHVybiBkZWZhdWx0VmFsdWU7XG4gIH1cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5jbGFzcyBTcHJpbmdBbmltYXRpb24gZXh0ZW5kcyBBbmltYXRpb24ge1xuICBfb3ZlcnNob290Q2xhbXBpbmc6IGJvb2xlYW47XG4gIF9yZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkOiBudW1iZXI7XG4gIF9yZXN0U3BlZWRUaHJlc2hvbGQ6IG51bWJlcjtcbiAgX2xhc3RWZWxvY2l0eTogbnVtYmVyO1xuICBfc3RhcnRQb3NpdGlvbjogbnVtYmVyO1xuICBfbGFzdFBvc2l0aW9uOiBudW1iZXI7XG4gIF9mcm9tVmFsdWU6IG51bWJlcjtcbiAgX3RvVmFsdWU6IGFueTtcbiAgX3N0aWZmbmVzczogbnVtYmVyO1xuICBfZGFtcGluZzogbnVtYmVyO1xuICBfbWFzczogbnVtYmVyO1xuICBfaW5pdGlhbFZlbG9jaXR5OiBudW1iZXI7XG4gIF9kZWxheTogbnVtYmVyO1xuICBfdGltZW91dDogYW55O1xuICBfc3RhcnRUaW1lOiBudW1iZXI7XG4gIF9sYXN0VGltZTogbnVtYmVyO1xuICBfZnJhbWVUaW1lOiBudW1iZXI7XG4gIF9vblVwZGF0ZTogKHZhbHVlOiBudW1iZXIpID0+IHZvaWQ7XG4gIF9hbmltYXRpb25GcmFtZTogYW55O1xuICBfdXNlTmF0aXZlRHJpdmVyOiBib29sZWFuO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogU3ByaW5nQW5pbWF0aW9uQ29uZmlnU2luZ2xlKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIHRoaXMuX292ZXJzaG9vdENsYW1waW5nID0gd2l0aERlZmF1bHQoY29uZmlnLm92ZXJzaG9vdENsYW1waW5nLCBmYWxzZSk7XG4gICAgdGhpcy5fcmVzdERpc3BsYWNlbWVudFRocmVzaG9sZCA9IHdpdGhEZWZhdWx0KFxuICAgICAgY29uZmlnLnJlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQsXG4gICAgICAwLjAwMSxcbiAgICApO1xuICAgIHRoaXMuX3Jlc3RTcGVlZFRocmVzaG9sZCA9IHdpdGhEZWZhdWx0KGNvbmZpZy5yZXN0U3BlZWRUaHJlc2hvbGQsIDAuMDAxKTtcbiAgICB0aGlzLl9pbml0aWFsVmVsb2NpdHkgPSB3aXRoRGVmYXVsdChjb25maWcudmVsb2NpdHksIDApO1xuICAgIHRoaXMuX2xhc3RWZWxvY2l0eSA9IHdpdGhEZWZhdWx0KGNvbmZpZy52ZWxvY2l0eSwgMCk7XG4gICAgdGhpcy5fdG9WYWx1ZSA9IGNvbmZpZy50b1ZhbHVlO1xuICAgIHRoaXMuX2RlbGF5ID0gd2l0aERlZmF1bHQoY29uZmlnLmRlbGF5LCAwKTtcbiAgICB0aGlzLl91c2VOYXRpdmVEcml2ZXIgPSBzaG91bGRVc2VOYXRpdmVEcml2ZXIoY29uZmlnKTtcbiAgICB0aGlzLl9faXNJbnRlcmFjdGlvbiA9XG4gICAgICBjb25maWcuaXNJbnRlcmFjdGlvbiAhPT0gdW5kZWZpbmVkID8gY29uZmlnLmlzSW50ZXJhY3Rpb24gOiB0cnVlO1xuICAgIHRoaXMuX19pdGVyYXRpb25zID0gY29uZmlnLml0ZXJhdGlvbnMgIT09IHVuZGVmaW5lZCA/IGNvbmZpZy5pdGVyYXRpb25zIDogMTtcblxuICAgIGlmIChcbiAgICAgIGNvbmZpZy5zdGlmZm5lc3MgIT09IHVuZGVmaW5lZCB8fFxuICAgICAgY29uZmlnLmRhbXBpbmcgIT09IHVuZGVmaW5lZCB8fFxuICAgICAgY29uZmlnLm1hc3MgIT09IHVuZGVmaW5lZFxuICAgICkge1xuICAgICAgaW52YXJpYW50KFxuICAgICAgICBjb25maWcuYm91bmNpbmVzcyA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgY29uZmlnLnNwZWVkID09PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICBjb25maWcudGVuc2lvbiA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgY29uZmlnLmZyaWN0aW9uID09PSB1bmRlZmluZWQsXG4gICAgICAgICdZb3UgY2FuIGRlZmluZSBvbmUgb2YgYm91bmNpbmVzcy9zcGVlZCwgdGVuc2lvbi9mcmljdGlvbiwgb3Igc3RpZmZuZXNzL2RhbXBpbmcvbWFzcywgYnV0IG5vdCBtb3JlIHRoYW4gb25lJyxcbiAgICAgICk7XG4gICAgICB0aGlzLl9zdGlmZm5lc3MgPSB3aXRoRGVmYXVsdChjb25maWcuc3RpZmZuZXNzLCAxMDApO1xuICAgICAgdGhpcy5fZGFtcGluZyA9IHdpdGhEZWZhdWx0KGNvbmZpZy5kYW1waW5nLCAxMCk7XG4gICAgICB0aGlzLl9tYXNzID0gd2l0aERlZmF1bHQoY29uZmlnLm1hc3MsIDEpO1xuICAgIH0gZWxzZSBpZiAoY29uZmlnLmJvdW5jaW5lc3MgIT09IHVuZGVmaW5lZCB8fCBjb25maWcuc3BlZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgLy8gQ29udmVydCB0aGUgb3JpZ2FtaSBib3VuY2luZXNzL3NwZWVkIHZhbHVlcyB0byBzdGlmZm5lc3MvZGFtcGluZ1xuICAgICAgLy8gV2UgYXNzdW1lIG1hc3MgaXMgMS5cbiAgICAgIGludmFyaWFudChcbiAgICAgICAgY29uZmlnLnRlbnNpb24gPT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgIGNvbmZpZy5mcmljdGlvbiA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgY29uZmlnLnN0aWZmbmVzcyA9PT0gdW5kZWZpbmVkICYmXG4gICAgICAgICAgY29uZmlnLmRhbXBpbmcgPT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgIGNvbmZpZy5tYXNzID09PSB1bmRlZmluZWQsXG4gICAgICAgICdZb3UgY2FuIGRlZmluZSBvbmUgb2YgYm91bmNpbmVzcy9zcGVlZCwgdGVuc2lvbi9mcmljdGlvbiwgb3Igc3RpZmZuZXNzL2RhbXBpbmcvbWFzcywgYnV0IG5vdCBtb3JlIHRoYW4gb25lJyxcbiAgICAgICk7XG4gICAgICBjb25zdCBzcHJpbmdDb25maWcgPSBTcHJpbmdDb25maWcuZnJvbUJvdW5jaW5lc3NBbmRTcGVlZChcbiAgICAgICAgd2l0aERlZmF1bHQoY29uZmlnLmJvdW5jaW5lc3MsIDgpLFxuICAgICAgICB3aXRoRGVmYXVsdChjb25maWcuc3BlZWQsIDEyKSxcbiAgICAgICk7XG4gICAgICB0aGlzLl9zdGlmZm5lc3MgPSBzcHJpbmdDb25maWcuc3RpZmZuZXNzO1xuICAgICAgdGhpcy5fZGFtcGluZyA9IHNwcmluZ0NvbmZpZy5kYW1waW5nO1xuICAgICAgdGhpcy5fbWFzcyA9IDE7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIENvbnZlcnQgdGhlIG9yaWdhbWkgdGVuc2lvbi9mcmljdGlvbiB2YWx1ZXMgdG8gc3RpZmZuZXNzL2RhbXBpbmdcbiAgICAgIC8vIFdlIGFzc3VtZSBtYXNzIGlzIDEuXG4gICAgICBjb25zdCBzcHJpbmdDb25maWcgPSBTcHJpbmdDb25maWcuZnJvbU9yaWdhbWlUZW5zaW9uQW5kRnJpY3Rpb24oXG4gICAgICAgIHdpdGhEZWZhdWx0KGNvbmZpZy50ZW5zaW9uLCA0MCksXG4gICAgICAgIHdpdGhEZWZhdWx0KGNvbmZpZy5mcmljdGlvbiwgNyksXG4gICAgICApO1xuICAgICAgdGhpcy5fc3RpZmZuZXNzID0gc3ByaW5nQ29uZmlnLnN0aWZmbmVzcztcbiAgICAgIHRoaXMuX2RhbXBpbmcgPSBzcHJpbmdDb25maWcuZGFtcGluZztcbiAgICAgIHRoaXMuX21hc3MgPSAxO1xuICAgIH1cblxuICAgIGludmFyaWFudCh0aGlzLl9zdGlmZm5lc3MgPiAwLCAnU3RpZmZuZXNzIHZhbHVlIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAnKTtcbiAgICBpbnZhcmlhbnQodGhpcy5fZGFtcGluZyA+IDAsICdEYW1waW5nIHZhbHVlIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAnKTtcbiAgICBpbnZhcmlhbnQodGhpcy5fbWFzcyA+IDAsICdNYXNzIHZhbHVlIG11c3QgYmUgZ3JlYXRlciB0aGFuIDAnKTtcbiAgfVxuXG4gIF9fZ2V0TmF0aXZlQW5pbWF0aW9uQ29uZmlnKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiAnc3ByaW5nJyxcbiAgICAgIG92ZXJzaG9vdENsYW1waW5nOiB0aGlzLl9vdmVyc2hvb3RDbGFtcGluZyxcbiAgICAgIHJlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQ6IHRoaXMuX3Jlc3REaXNwbGFjZW1lbnRUaHJlc2hvbGQsXG4gICAgICByZXN0U3BlZWRUaHJlc2hvbGQ6IHRoaXMuX3Jlc3RTcGVlZFRocmVzaG9sZCxcbiAgICAgIHN0aWZmbmVzczogdGhpcy5fc3RpZmZuZXNzLFxuICAgICAgZGFtcGluZzogdGhpcy5fZGFtcGluZyxcbiAgICAgIG1hc3M6IHRoaXMuX21hc3MsXG4gICAgICBpbml0aWFsVmVsb2NpdHk6IHdpdGhEZWZhdWx0KHRoaXMuX2luaXRpYWxWZWxvY2l0eSwgdGhpcy5fbGFzdFZlbG9jaXR5KSxcbiAgICAgIHRvVmFsdWU6IHRoaXMuX3RvVmFsdWUsXG4gICAgICBpdGVyYXRpb25zOiB0aGlzLl9faXRlcmF0aW9ucyxcbiAgICB9O1xuICB9XG5cbiAgc3RhcnQoXG4gICAgZnJvbVZhbHVlOiBudW1iZXIsXG4gICAgb25VcGRhdGU6ICh2YWx1ZTogbnVtYmVyKSA9PiB2b2lkLFxuICAgIG9uRW5kOiA/RW5kQ2FsbGJhY2ssXG4gICAgcHJldmlvdXNBbmltYXRpb246ID9BbmltYXRpb24sXG4gICAgYW5pbWF0ZWRWYWx1ZTogQW5pbWF0ZWRWYWx1ZSxcbiAgKTogdm9pZCB7XG4gICAgdGhpcy5fX2FjdGl2ZSA9IHRydWU7XG4gICAgdGhpcy5fc3RhcnRQb3NpdGlvbiA9IGZyb21WYWx1ZTtcbiAgICB0aGlzLl9sYXN0UG9zaXRpb24gPSB0aGlzLl9zdGFydFBvc2l0aW9uO1xuXG4gICAgdGhpcy5fb25VcGRhdGUgPSBvblVwZGF0ZTtcbiAgICB0aGlzLl9fb25FbmQgPSBvbkVuZDtcbiAgICB0aGlzLl9sYXN0VGltZSA9IERhdGUubm93KCk7XG4gICAgdGhpcy5fZnJhbWVUaW1lID0gMC4wO1xuXG4gICAgaWYgKHByZXZpb3VzQW5pbWF0aW9uIGluc3RhbmNlb2YgU3ByaW5nQW5pbWF0aW9uKSB7XG4gICAgICBjb25zdCBpbnRlcm5hbFN0YXRlID0gcHJldmlvdXNBbmltYXRpb24uZ2V0SW50ZXJuYWxTdGF0ZSgpO1xuICAgICAgdGhpcy5fbGFzdFBvc2l0aW9uID0gaW50ZXJuYWxTdGF0ZS5sYXN0UG9zaXRpb247XG4gICAgICB0aGlzLl9sYXN0VmVsb2NpdHkgPSBpbnRlcm5hbFN0YXRlLmxhc3RWZWxvY2l0eTtcbiAgICAgIC8vIFNldCB0aGUgaW5pdGlhbCB2ZWxvY2l0eSB0byB0aGUgbGFzdCB2ZWxvY2l0eVxuICAgICAgdGhpcy5faW5pdGlhbFZlbG9jaXR5ID0gdGhpcy5fbGFzdFZlbG9jaXR5O1xuICAgICAgdGhpcy5fbGFzdFRpbWUgPSBpbnRlcm5hbFN0YXRlLmxhc3RUaW1lO1xuICAgIH1cblxuICAgIGNvbnN0IHN0YXJ0ID0gKCkgPT4ge1xuICAgICAgaWYgKHRoaXMuX3VzZU5hdGl2ZURyaXZlcikge1xuICAgICAgICB0aGlzLl9fc3RhcnROYXRpdmVBbmltYXRpb24oYW5pbWF0ZWRWYWx1ZSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLm9uVXBkYXRlKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vICBJZiB0aGlzLl9kZWxheSBpcyBtb3JlIHRoYW4gMCwgd2Ugc3RhcnQgYWZ0ZXIgdGhlIHRpbWVvdXQuXG4gICAgaWYgKHRoaXMuX2RlbGF5KSB7XG4gICAgICB0aGlzLl90aW1lb3V0ID0gc2V0VGltZW91dChzdGFydCwgdGhpcy5fZGVsYXkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzdGFydCgpO1xuICAgIH1cbiAgfVxuXG4gIGdldEludGVybmFsU3RhdGUoKTogT2JqZWN0IHtcbiAgICByZXR1cm4ge1xuICAgICAgbGFzdFBvc2l0aW9uOiB0aGlzLl9sYXN0UG9zaXRpb24sXG4gICAgICBsYXN0VmVsb2NpdHk6IHRoaXMuX2xhc3RWZWxvY2l0eSxcbiAgICAgIGxhc3RUaW1lOiB0aGlzLl9sYXN0VGltZSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFRoaXMgc3ByaW5nIG1vZGVsIGlzIGJhc2VkIG9mZiBvZiBhIGRhbXBlZCBoYXJtb25pYyBvc2NpbGxhdG9yXG4gICAqIChodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9IYXJtb25pY19vc2NpbGxhdG9yI0RhbXBlZF9oYXJtb25pY19vc2NpbGxhdG9yKS5cbiAgICpcbiAgICogV2UgdXNlIHRoZSBjbG9zZWQgZm9ybSBvZiB0aGUgc2Vjb25kIG9yZGVyIGRpZmZlcmVudGlhbCBlcXVhdGlvbjpcbiAgICpcbiAgICogeCcnICsgKDLOtuKNtV8wKXgnICsg4o21XjJ4ID0gMFxuICAgKlxuICAgKiB3aGVyZVxuICAgKiAgICDijbVfMCA9IOKImihrIC8gbSkgKHVuZGFtcGVkIGFuZ3VsYXIgZnJlcXVlbmN5IG9mIHRoZSBvc2NpbGxhdG9yKSxcbiAgICogICAgzrYgPSBjIC8gMuKImm1rIChkYW1waW5nIHJhdGlvKSxcbiAgICogICAgYyA9IGRhbXBpbmcgY29uc3RhbnRcbiAgICogICAgayA9IHN0aWZmbmVzc1xuICAgKiAgICBtID0gbWFzc1xuICAgKlxuICAgKiBUaGUgZGVyaXZhdGlvbiBvZiB0aGUgY2xvc2VkIGZvcm0gaXMgZGVzY3JpYmVkIGluIGRldGFpbCBoZXJlOlxuICAgKiBodHRwOi8vcGxhbmV0bWF0aC5vcmcvc2l0ZXMvZGVmYXVsdC9maWxlcy90ZXhwZGYvMzk3NDUucGRmXG4gICAqXG4gICAqIFRoaXMgYWxnb3JpdGhtIGhhcHBlbnMgdG8gbWF0Y2ggdGhlIGFsZ29yaXRobSB1c2VkIGJ5IENBU3ByaW5nQW5pbWF0aW9uLFxuICAgKiBhIFF1YXJ0ekNvcmUgKGlPUykgQVBJIHRoYXQgY3JlYXRlcyBzcHJpbmcgYW5pbWF0aW9ucy5cbiAgICovXG4gIG9uVXBkYXRlKCk6IHZvaWQge1xuICAgIC8vIElmIGZvciBzb21lIHJlYXNvbiB3ZSBsb3N0IGEgbG90IG9mIGZyYW1lcyAoZS5nLiBwcm9jZXNzIGxhcmdlIHBheWxvYWQgb3JcbiAgICAvLyBzdG9wcGVkIGluIHRoZSBkZWJ1Z2dlciksIHdlIG9ubHkgYWR2YW5jZSBieSA0IGZyYW1lcyB3b3J0aCBvZlxuICAgIC8vIGNvbXB1dGF0aW9uIGFuZCB3aWxsIGNvbnRpbnVlIG9uIHRoZSBuZXh0IGZyYW1lLiBJdCdzIGJldHRlciB0byBoYXZlIGl0XG4gICAgLy8gcnVubmluZyBhdCBmYXN0ZXIgc3BlZWQgdGhhbiBqdW1waW5nIHRvIHRoZSBlbmQuXG4gICAgY29uc3QgTUFYX1NURVBTID0gNjQ7XG4gICAgbGV0IG5vdyA9IERhdGUubm93KCk7XG4gICAgaWYgKG5vdyA+IHRoaXMuX2xhc3RUaW1lICsgTUFYX1NURVBTKSB7XG4gICAgICBub3cgPSB0aGlzLl9sYXN0VGltZSArIE1BWF9TVEVQUztcbiAgICB9XG5cbiAgICBjb25zdCBkZWx0YVRpbWUgPSAobm93IC0gdGhpcy5fbGFzdFRpbWUpIC8gMTAwMDtcbiAgICB0aGlzLl9mcmFtZVRpbWUgKz0gZGVsdGFUaW1lO1xuXG4gICAgY29uc3QgYzogbnVtYmVyID0gdGhpcy5fZGFtcGluZztcbiAgICBjb25zdCBtOiBudW1iZXIgPSB0aGlzLl9tYXNzO1xuICAgIGNvbnN0IGs6IG51bWJlciA9IHRoaXMuX3N0aWZmbmVzcztcbiAgICBjb25zdCB2MDogbnVtYmVyID0gLXRoaXMuX2luaXRpYWxWZWxvY2l0eTtcblxuICAgIGNvbnN0IHpldGEgPSBjIC8gKDIgKiBNYXRoLnNxcnQoayAqIG0pKTsgLy8gZGFtcGluZyByYXRpb1xuICAgIGNvbnN0IG9tZWdhMCA9IE1hdGguc3FydChrIC8gbSk7IC8vIHVuZGFtcGVkIGFuZ3VsYXIgZnJlcXVlbmN5IG9mIHRoZSBvc2NpbGxhdG9yIChyYWQvbXMpXG4gICAgY29uc3Qgb21lZ2ExID0gb21lZ2EwICogTWF0aC5zcXJ0KDEuMCAtIHpldGEgKiB6ZXRhKTsgLy8gZXhwb25lbnRpYWwgZGVjYXlcbiAgICBjb25zdCB4MCA9IHRoaXMuX3RvVmFsdWUgLSB0aGlzLl9zdGFydFBvc2l0aW9uOyAvLyBjYWxjdWxhdGUgdGhlIG9zY2lsbGF0aW9uIGZyb20geDAgPSAxIHRvIHggPSAwXG5cbiAgICBsZXQgcG9zaXRpb24gPSAwLjA7XG4gICAgbGV0IHZlbG9jaXR5ID0gMC4wO1xuICAgIGNvbnN0IHQgPSB0aGlzLl9mcmFtZVRpbWU7XG4gICAgaWYgKHpldGEgPCAxKSB7XG4gICAgICAvLyBVbmRlciBkYW1wZWRcbiAgICAgIGNvbnN0IGVudmVsb3BlID0gTWF0aC5leHAoLXpldGEgKiBvbWVnYTAgKiB0KTtcbiAgICAgIHBvc2l0aW9uID1cbiAgICAgICAgdGhpcy5fdG9WYWx1ZSAtXG4gICAgICAgIGVudmVsb3BlICpcbiAgICAgICAgICAoKCh2MCArIHpldGEgKiBvbWVnYTAgKiB4MCkgLyBvbWVnYTEpICogTWF0aC5zaW4ob21lZ2ExICogdCkgK1xuICAgICAgICAgICAgeDAgKiBNYXRoLmNvcyhvbWVnYTEgKiB0KSk7XG4gICAgICAvLyBUaGlzIGxvb2tzIGNyYXp5IC0tIGl0J3MgYWN0dWFsbHkganVzdCB0aGUgZGVyaXZhdGl2ZSBvZiB0aGVcbiAgICAgIC8vIG9zY2lsbGF0aW9uIGZ1bmN0aW9uXG4gICAgICB2ZWxvY2l0eSA9XG4gICAgICAgIHpldGEgKlxuICAgICAgICAgIG9tZWdhMCAqXG4gICAgICAgICAgZW52ZWxvcGUgKlxuICAgICAgICAgICgoTWF0aC5zaW4ob21lZ2ExICogdCkgKiAodjAgKyB6ZXRhICogb21lZ2EwICogeDApKSAvIG9tZWdhMSArXG4gICAgICAgICAgICB4MCAqIE1hdGguY29zKG9tZWdhMSAqIHQpKSAtXG4gICAgICAgIGVudmVsb3BlICpcbiAgICAgICAgICAoTWF0aC5jb3Mob21lZ2ExICogdCkgKiAodjAgKyB6ZXRhICogb21lZ2EwICogeDApIC1cbiAgICAgICAgICAgIG9tZWdhMSAqIHgwICogTWF0aC5zaW4ob21lZ2ExICogdCkpO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBDcml0aWNhbGx5IGRhbXBlZFxuICAgICAgY29uc3QgZW52ZWxvcGUgPSBNYXRoLmV4cCgtb21lZ2EwICogdCk7XG4gICAgICBwb3NpdGlvbiA9IHRoaXMuX3RvVmFsdWUgLSBlbnZlbG9wZSAqICh4MCArICh2MCArIG9tZWdhMCAqIHgwKSAqIHQpO1xuICAgICAgdmVsb2NpdHkgPVxuICAgICAgICBlbnZlbG9wZSAqICh2MCAqICh0ICogb21lZ2EwIC0gMSkgKyB0ICogeDAgKiAob21lZ2EwICogb21lZ2EwKSk7XG4gICAgfVxuXG4gICAgdGhpcy5fbGFzdFRpbWUgPSBub3c7XG4gICAgdGhpcy5fbGFzdFBvc2l0aW9uID0gcG9zaXRpb247XG4gICAgdGhpcy5fbGFzdFZlbG9jaXR5ID0gdmVsb2NpdHk7XG5cbiAgICB0aGlzLl9vblVwZGF0ZShwb3NpdGlvbik7XG4gICAgaWYgKCF0aGlzLl9fYWN0aXZlKSB7XG4gICAgICAvLyBhIGxpc3RlbmVyIG1pZ2h0IGhhdmUgc3RvcHBlZCB1cyBpbiBfb25VcGRhdGVcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDb25kaXRpb25zIGZvciBzdG9wcGluZyB0aGUgc3ByaW5nIGFuaW1hdGlvblxuICAgIGxldCBpc092ZXJzaG9vdGluZyA9IGZhbHNlO1xuICAgIGlmICh0aGlzLl9vdmVyc2hvb3RDbGFtcGluZyAmJiB0aGlzLl9zdGlmZm5lc3MgIT09IDApIHtcbiAgICAgIGlmICh0aGlzLl9zdGFydFBvc2l0aW9uIDwgdGhpcy5fdG9WYWx1ZSkge1xuICAgICAgICBpc092ZXJzaG9vdGluZyA9IHBvc2l0aW9uID4gdGhpcy5fdG9WYWx1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlzT3ZlcnNob290aW5nID0gcG9zaXRpb24gPCB0aGlzLl90b1ZhbHVlO1xuICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBpc1ZlbG9jaXR5ID0gTWF0aC5hYnModmVsb2NpdHkpIDw9IHRoaXMuX3Jlc3RTcGVlZFRocmVzaG9sZDtcbiAgICBsZXQgaXNEaXNwbGFjZW1lbnQgPSB0cnVlO1xuICAgIGlmICh0aGlzLl9zdGlmZm5lc3MgIT09IDApIHtcbiAgICAgIGlzRGlzcGxhY2VtZW50ID1cbiAgICAgICAgTWF0aC5hYnModGhpcy5fdG9WYWx1ZSAtIHBvc2l0aW9uKSA8PSB0aGlzLl9yZXN0RGlzcGxhY2VtZW50VGhyZXNob2xkO1xuICAgIH1cblxuICAgIGlmIChpc092ZXJzaG9vdGluZyB8fCAoaXNWZWxvY2l0eSAmJiBpc0Rpc3BsYWNlbWVudCkpIHtcbiAgICAgIGlmICh0aGlzLl9zdGlmZm5lc3MgIT09IDApIHtcbiAgICAgICAgLy8gRW5zdXJlIHRoYXQgd2UgZW5kIHVwIHdpdGggYSByb3VuZCB2YWx1ZVxuICAgICAgICB0aGlzLl9sYXN0UG9zaXRpb24gPSB0aGlzLl90b1ZhbHVlO1xuICAgICAgICB0aGlzLl9sYXN0VmVsb2NpdHkgPSAwO1xuICAgICAgICB0aGlzLl9vblVwZGF0ZSh0aGlzLl90b1ZhbHVlKTtcbiAgICAgIH1cblxuICAgICAgdGhpcy5fX2RlYm91bmNlZE9uRW5kKHtmaW5pc2hlZDogdHJ1ZX0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLl9hbmltYXRpb25GcmFtZSA9IHJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLm9uVXBkYXRlLmJpbmQodGhpcykpO1xuICB9XG5cbiAgc3RvcCgpOiB2b2lkIHtcbiAgICBzdXBlci5zdG9wKCk7XG4gICAgdGhpcy5fX2FjdGl2ZSA9IGZhbHNlO1xuICAgIGNsZWFyVGltZW91dCh0aGlzLl90aW1lb3V0KTtcbiAgICBnbG9iYWwuY2FuY2VsQW5pbWF0aW9uRnJhbWUodGhpcy5fYW5pbWF0aW9uRnJhbWUpO1xuICAgIHRoaXMuX19kZWJvdW5jZWRPbkVuZCh7ZmluaXNoZWQ6IGZhbHNlfSk7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBTcHJpbmdBbmltYXRpb247XG4iXX0=