65fc94d68c2dea099b0d6656dc679420

'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var invariant = require('fbjs/lib/invariant');
var isEmpty = require('isEmpty');

var warning = require('fbjs/lib/warning');

function defaultGetRowData(dataBlob, sectionID, rowID) {
  return dataBlob[sectionID][rowID];
}

function defaultGetSectionHeaderData(dataBlob, sectionID) {
  return dataBlob[sectionID];
}

var ListViewDataSource = function () {
  function ListViewDataSource(params) {
    _classCallCheck(this, ListViewDataSource);

    invariant(params && typeof params.rowHasChanged === 'function', 'Must provide a rowHasChanged function.');
    this._rowHasChanged = params.rowHasChanged;
    this._getRowData = params.getRowData || defaultGetRowData;
    this._sectionHeaderHasChanged = params.sectionHeaderHasChanged;
    this._getSectionHeaderData = params.getSectionHeaderData || defaultGetSectionHeaderData;

    this._dataBlob = null;
    this._dirtyRows = [];
    this._dirtySections = [];
    this._cachedRowCount = 0;

    this.rowIdentities = [];
    this.sectionIdentities = [];
  }

  _createClass(ListViewDataSource, [{
    key: 'cloneWithRows',
    value: function cloneWithRows(dataBlob, rowIdentities) {
      var rowIds = rowIdentities ? [[].concat(_toConsumableArray(rowIdentities))] : null;
      if (!this._sectionHeaderHasChanged) {
        this._sectionHeaderHasChanged = function () {
          return false;
        };
      }
      return this.cloneWithRowsAndSections({ s1: dataBlob }, ['s1'], rowIds);
    }
  }, {
    key: 'cloneWithRowsAndSections',
    value: function cloneWithRowsAndSections(dataBlob, sectionIdentities, rowIdentities) {
      invariant(typeof this._sectionHeaderHasChanged === 'function', 'Must provide a sectionHeaderHasChanged function with section data.');
      invariant(!sectionIdentities || !rowIdentities || sectionIdentities.length === rowIdentities.length, 'row and section ids lengths must be the same');

      var newSource = new ListViewDataSource({
        getRowData: this._getRowData,
        getSectionHeaderData: this._getSectionHeaderData,
        rowHasChanged: this._rowHasChanged,
        sectionHeaderHasChanged: this._sectionHeaderHasChanged
      });
      newSource._dataBlob = dataBlob;
      if (sectionIdentities) {
        newSource.sectionIdentities = sectionIdentities;
      } else {
        newSource.sectionIdentities = Object.keys(dataBlob);
      }
      if (rowIdentities) {
        newSource.rowIdentities = rowIdentities;
      } else {
        newSource.rowIdentities = [];
        newSource.sectionIdentities.forEach(function (sectionID) {
          newSource.rowIdentities.push(Object.keys(dataBlob[sectionID]));
        });
      }
      newSource._cachedRowCount = countRows(newSource.rowIdentities);

      newSource._calculateDirtyArrays(this._dataBlob, this.sectionIdentities, this.rowIdentities);

      return newSource;
    }
  }, {
    key: 'getRowCount',
    value: function getRowCount() {
      return this._cachedRowCount;
    }
  }, {
    key: 'getRowAndSectionCount',
    value: function getRowAndSectionCount() {
      return this._cachedRowCount + this.sectionIdentities.length;
    }
  }, {
    key: 'rowShouldUpdate',
    value: function rowShouldUpdate(sectionIndex, rowIndex) {
      var needsUpdate = this._dirtyRows[sectionIndex][rowIndex];
      warning(needsUpdate !== undefined, 'missing dirtyBit for section, row: ' + sectionIndex + ', ' + rowIndex);
      return needsUpdate;
    }
  }, {
    key: 'getRowData',
    value: function getRowData(sectionIndex, rowIndex) {
      var sectionID = this.sectionIdentities[sectionIndex];
      var rowID = this.rowIdentities[sectionIndex][rowIndex];
      warning(sectionID !== undefined && rowID !== undefined, 'rendering invalid section, row: ' + sectionIndex + ', ' + rowIndex);
      return this._getRowData(this._dataBlob, sectionID, rowID);
    }
  }, {
    key: 'getRowIDForFlatIndex',
    value: function getRowIDForFlatIndex(index) {
      var accessIndex = index;
      for (var ii = 0; ii < this.sectionIdentities.length; ii++) {
        if (accessIndex >= this.rowIdentities[ii].length) {
          accessIndex -= this.rowIdentities[ii].length;
        } else {
          return this.rowIdentities[ii][accessIndex];
        }
      }
      return null;
    }
  }, {
    key: 'getSectionIDForFlatIndex',
    value: function getSectionIDForFlatIndex(index) {
      var accessIndex = index;
      for (var ii = 0; ii < this.sectionIdentities.length; ii++) {
        if (accessIndex >= this.rowIdentities[ii].length) {
          accessIndex -= this.rowIdentities[ii].length;
        } else {
          return this.sectionIdentities[ii];
        }
      }
      return null;
    }
  }, {
    key: 'getSectionLengths',
    value: function getSectionLengths() {
      var results = [];
      for (var ii = 0; ii < this.sectionIdentities.length; ii++) {
        results.push(this.rowIdentities[ii].length);
      }
      return results;
    }
  }, {
    key: 'sectionHeaderShouldUpdate',
    value: function sectionHeaderShouldUpdate(sectionIndex) {
      var needsUpdate = this._dirtySections[sectionIndex];
      warning(needsUpdate !== undefined, 'missing dirtyBit for section: ' + sectionIndex);
      return needsUpdate;
    }
  }, {
    key: 'getSectionHeaderData',
    value: function getSectionHeaderData(sectionIndex) {
      if (!this._getSectionHeaderData) {
        return null;
      }
      var sectionID = this.sectionIdentities[sectionIndex];
      warning(sectionID !== undefined, 'renderSection called on invalid section: ' + sectionIndex);
      return this._getSectionHeaderData(this._dataBlob, sectionID);
    }
  }, {
    key: '_calculateDirtyArrays',
    value: function _calculateDirtyArrays(prevDataBlob, prevSectionIDs, prevRowIDs) {
      var prevSectionsHash = keyedDictionaryFromArray(prevSectionIDs);
      var prevRowsHash = {};
      for (var ii = 0; ii < prevRowIDs.length; ii++) {
        var sectionID = prevSectionIDs[ii];
        warning(!prevRowsHash[sectionID], 'SectionID appears more than once: ' + sectionID);
        prevRowsHash[sectionID] = keyedDictionaryFromArray(prevRowIDs[ii]);
      }

      this._dirtySections = [];
      this._dirtyRows = [];

      var dirty = void 0;
      for (var sIndex = 0; sIndex < this.sectionIdentities.length; sIndex++) {
        var sectionID = this.sectionIdentities[sIndex];

        dirty = !prevSectionsHash[sectionID];
        var _sectionHeaderHasChanged = this._sectionHeaderHasChanged;
        if (!dirty && _sectionHeaderHasChanged) {
          dirty = _sectionHeaderHasChanged(this._getSectionHeaderData(prevDataBlob, sectionID), this._getSectionHeaderData(this._dataBlob, sectionID));
        }
        this._dirtySections.push(!!dirty);

        this._dirtyRows[sIndex] = [];
        for (var rIndex = 0; rIndex < this.rowIdentities[sIndex].length; rIndex++) {
          var rowID = this.rowIdentities[sIndex][rIndex];

          dirty = !prevSectionsHash[sectionID] || !prevRowsHash[sectionID][rowID] || this._rowHasChanged(this._getRowData(prevDataBlob, sectionID, rowID), this._getRowData(this._dataBlob, sectionID, rowID));
          this._dirtyRows[sIndex].push(!!dirty);
        }
      }
    }
  }]);

  return ListViewDataSource;
}();

function countRows(allRowIDs) {
  var totalRows = 0;
  for (var sectionIdx = 0; sectionIdx < allRowIDs.length; sectionIdx++) {
    var rowIDs = allRowIDs[sectionIdx];
    totalRows += rowIDs.length;
  }
  return totalRows;
}

function keyedDictionaryFromArray(arr) {
  if (isEmpty(arr)) {
    return {};
  }
  var result = {};
  for (var ii = 0; ii < arr.length; ii++) {
    var _key = arr[ii];
    warning(!result[_key], 'Value appears more than once in array: ' + _key);
    result[_key] = true;
  }
  return result;
}

module.exports = ListViewDataSource;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkxpc3RWaWV3RGF0YVNvdXJjZS5qcyJdLCJuYW1lcyI6WyJpbnZhcmlhbnQiLCJyZXF1aXJlIiwiaXNFbXB0eSIsIndhcm5pbmciLCJkZWZhdWx0R2V0Um93RGF0YSIsImRhdGFCbG9iIiwic2VjdGlvbklEIiwicm93SUQiLCJkZWZhdWx0R2V0U2VjdGlvbkhlYWRlckRhdGEiLCJMaXN0Vmlld0RhdGFTb3VyY2UiLCJwYXJhbXMiLCJyb3dIYXNDaGFuZ2VkIiwiX3Jvd0hhc0NoYW5nZWQiLCJfZ2V0Um93RGF0YSIsImdldFJvd0RhdGEiLCJfc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQiLCJzZWN0aW9uSGVhZGVySGFzQ2hhbmdlZCIsIl9nZXRTZWN0aW9uSGVhZGVyRGF0YSIsImdldFNlY3Rpb25IZWFkZXJEYXRhIiwiX2RhdGFCbG9iIiwiX2RpcnR5Um93cyIsIl9kaXJ0eVNlY3Rpb25zIiwiX2NhY2hlZFJvd0NvdW50Iiwicm93SWRlbnRpdGllcyIsInNlY3Rpb25JZGVudGl0aWVzIiwicm93SWRzIiwiY2xvbmVXaXRoUm93c0FuZFNlY3Rpb25zIiwiczEiLCJsZW5ndGgiLCJuZXdTb3VyY2UiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsInB1c2giLCJjb3VudFJvd3MiLCJfY2FsY3VsYXRlRGlydHlBcnJheXMiLCJzZWN0aW9uSW5kZXgiLCJyb3dJbmRleCIsIm5lZWRzVXBkYXRlIiwidW5kZWZpbmVkIiwiaW5kZXgiLCJhY2Nlc3NJbmRleCIsImlpIiwicmVzdWx0cyIsInByZXZEYXRhQmxvYiIsInByZXZTZWN0aW9uSURzIiwicHJldlJvd0lEcyIsInByZXZTZWN0aW9uc0hhc2giLCJrZXllZERpY3Rpb25hcnlGcm9tQXJyYXkiLCJwcmV2Um93c0hhc2giLCJkaXJ0eSIsInNJbmRleCIsInJJbmRleCIsImFsbFJvd0lEcyIsInRvdGFsUm93cyIsInNlY3Rpb25JZHgiLCJyb3dJRHMiLCJhcnIiLCJyZXN1bHQiLCJrZXkiLCJtb2R1bGUiLCJleHBv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QUFDQSxPQUFLLElBQUloQixLQUFLLENBQWQsRUFBaUJBLEtBQUtlLElBQUk3QixNQUExQixFQUFrQ2MsSUFBbEMsRUFBd0M7QUFDdEMsUUFBTWlCLE9BQU1GLElBQUlmLEVBQUosQ0FBWjtBQUNBdkMsWUFBUSxDQUFDdUQsT0FBT0MsSUFBUCxDQUFULEVBQXNCLDRDQUE0Q0EsSUFBbEU7QUFDQUQsV0FBT0MsSUFBUCxJQUFjLElBQWQ7QUFDRDtBQUNELFNBQU9ELE1BQVA7QUFDRDs7QUFFREUsT0FBT0MsT0FBUCxHQUFpQnBELGtCQUFqQiIsImZpbGUiOiJMaXN0Vmlld0RhdGFTb3VyY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICpcbiAqIFRoaXMgc291cmNlIGNvZGUgaXMgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIGZvdW5kIGluIHRoZVxuICogTElDRU5TRSBmaWxlIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHNvdXJjZSB0cmVlLlxuICpcbiAqIEBmbG93XG4gKiBAZm9ybWF0XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuY29uc3QgaW52YXJpYW50ID0gcmVxdWlyZSgnZmJqcy9saWIvaW52YXJpYW50Jyk7XG5jb25zdCBpc0VtcHR5ID0gcmVxdWlyZSgnaXNFbXB0eScpO1xuLyogJEZsb3dGaXhNZSg+PTAuNTQuMCBzaXRlPXJlYWN0X25hdGl2ZV9vc3MpIFRoaXMgY29tbWVudCBzdXBwcmVzc2VzIGFuIGVycm9yXG4gKiBmb3VuZCB3aGVuIEZsb3cgdjAuNTQgd2FzIGRlcGxveWVkLiBUbyBzZWUgdGhlIGVycm9yIGRlbGV0ZSB0aGlzIGNvbW1lbnQgYW5kXG4gKiBydW4gRmxvdy4gKi9cbmNvbnN0IHdhcm5pbmcgPSByZXF1aXJlKCdmYmpzL2xpYi93YXJuaW5nJyk7XG5cbmZ1bmN0aW9uIGRlZmF1bHRHZXRSb3dEYXRhKFxuICBkYXRhQmxvYjogYW55LFxuICBzZWN0aW9uSUQ6IG51bWJlciB8IHN0cmluZyxcbiAgcm93SUQ6IG51bWJlciB8IHN0cmluZyxcbik6IGFueSB7XG4gIHJldHVybiBkYXRhQmxvYltzZWN0aW9uSURdW3Jvd0lEXTtcbn1cblxuZnVuY3Rpb24gZGVmYXVsdEdldFNlY3Rpb25IZWFkZXJEYXRhKFxuICBkYXRhQmxvYjogYW55LFxuICBzZWN0aW9uSUQ6IG51bWJlciB8IHN0cmluZyxcbik6IGFueSB7XG4gIHJldHVybiBkYXRhQmxvYltzZWN0aW9uSURdO1xufVxuXG50eXBlIGRpZmZlclR5cGUgPSAoZGF0YTE6IGFueSwgZGF0YTI6IGFueSkgPT4gYm9vbGVhbjtcblxudHlwZSBQYXJhbVR5cGUgPSB7XG4gIHJvd0hhc0NoYW5nZWQ6IGRpZmZlclR5cGUsXG4gIGdldFJvd0RhdGE/OiA/dHlwZW9mIGRlZmF1bHRHZXRSb3dEYXRhLFxuICBzZWN0aW9uSGVhZGVySGFzQ2hhbmdlZD86ID9kaWZmZXJUeXBlLFxuICBnZXRTZWN0aW9uSGVhZGVyRGF0YT86ID90eXBlb2YgZGVmYXVsdEdldFNlY3Rpb25IZWFkZXJEYXRhLFxufTtcblxuLyoqXG4gKiBQcm92aWRlcyBlZmZpY2llbnQgZGF0YSBwcm9jZXNzaW5nIGFuZCBhY2Nlc3MgdG8gdGhlXG4gKiBgTGlzdFZpZXdgIGNvbXBvbmVudC4gIEEgYExpc3RWaWV3RGF0YVNvdXJjZWAgaXMgY3JlYXRlZCB3aXRoIGZ1bmN0aW9ucyBmb3JcbiAqIGV4dHJhY3RpbmcgZGF0YSBmcm9tIHRoZSBpbnB1dCBibG9iLCBhbmQgY29tcGFyaW5nIGVsZW1lbnRzICh3aXRoIGRlZmF1bHRcbiAqIGltcGxlbWVudGF0aW9ucyBmb3IgY29udmVuaWVuY2UpLiAgVGhlIGlucHV0IGJsb2IgY2FuIGJlIGFzIHNpbXBsZSBhcyBhblxuICogYXJyYXkgb2Ygc3RyaW5ncywgb3IgYW4gb2JqZWN0IHdpdGggcm93cyBuZXN0ZWQgaW5zaWRlIHNlY3Rpb24gb2JqZWN0cy5cbiAqXG4gKiBUbyB1cGRhdGUgdGhlIGRhdGEgaW4gdGhlIGRhdGFzb3VyY2UsIHVzZSBgY2xvbmVXaXRoUm93c2AgKG9yXG4gKiBgY2xvbmVXaXRoUm93c0FuZFNlY3Rpb25zYCBpZiB5b3UgY2FyZSBhYm91dCBzZWN0aW9ucykuICBUaGUgZGF0YSBpbiB0aGVcbiAqIGRhdGEgc291cmNlIGlzIGltbXV0YWJsZSwgc28geW91IGNhbid0IG1vZGlmeSBpdCBkaXJlY3RseS4gIFRoZSBjbG9uZSBtZXRob2RzXG4gKiBzdWNrIGluIHRoZSBuZXcgZGF0YSBhbmQgY29tcHV0ZSBhIGRpZmYgZm9yIGVhY2ggcm93IHNvIExpc3RWaWV3IGtub3dzXG4gKiB3aGV0aGVyIHRvIHJlLXJlbmRlciBpdCBvciBub3QuXG4gKlxuICogSW4gdGhpcyBleGFtcGxlLCBhIGNvbXBvbmVudCByZWNlaXZlcyBkYXRhIGluIGNodW5rcywgaGFuZGxlZCBieVxuICogYF9vbkRhdGFBcnJpdmVkYCwgd2hpY2ggY29uY2F0cyB0aGUgbmV3IGRhdGEgb250byB0aGUgb2xkIGRhdGEgYW5kIHVwZGF0ZXMgdGhlXG4gKiBkYXRhIHNvdXJjZS4gIFdlIHVzZSBgY29uY2F0YCB0byBjcmVhdGUgYSBuZXcgYXJyYXkgLSBtdXRhdGluZyBgdGhpcy5fZGF0YWAsXG4gKiBlLmcuIHdpdGggYHRoaXMuX2RhdGEucHVzaChuZXdSb3dEYXRhKWAsIHdvdWxkIGJlIGFuIGVycm9yLiBgX3Jvd0hhc0NoYW5nZWRgXG4gKiB1bmRlcnN0YW5kcyB0aGUgc2hhcGUgb2YgdGhlIHJvdyBkYXRhIGFuZCBrbm93cyBob3cgdG8gZWZmaWNpZW50bHkgY29tcGFyZVxuICogaXQuXG4gKlxuICogYGBgXG4gKiBnZXRJbml0aWFsU3RhdGU6IGZ1bmN0aW9uKCkge1xuICogICB2YXIgZHMgPSBuZXcgTGlzdFZpZXcuRGF0YVNvdXJjZSh7cm93SGFzQ2hhbmdlZDogdGhpcy5fcm93SGFzQ2hhbmdlZH0pO1xuICogICByZXR1cm4ge2RzfTtcbiAqIH0sXG4gKiBfb25EYXRhQXJyaXZlZChuZXdEYXRhKSB7XG4gKiAgIHRoaXMuX2RhdGEgPSB0aGlzLl9kYXRhLmNvbmNhdChuZXdEYXRhKTtcbiAqICAgdGhpcy5zZXRTdGF0ZSh7XG4gKiAgICAgZHM6IHRoaXMuc3RhdGUuZHMuY2xvbmVXaXRoUm93cyh0aGlzLl9kYXRhKVxuICogICB9KTtcbiAqIH1cbiAqIGBgYFxuICovXG5cbmNsYXNzIExpc3RWaWV3RGF0YVNvdXJjZSB7XG4gIC8qKlxuICAgKiBZb3UgY2FuIHByb3ZpZGUgY3VzdG9tIGV4dHJhY3Rpb24gYW5kIGBoYXNDaGFuZ2VkYCBmdW5jdGlvbnMgZm9yIHNlY3Rpb25cbiAgICogaGVhZGVycyBhbmQgcm93cy4gIElmIGFic2VudCwgZGF0YSB3aWxsIGJlIGV4dHJhY3RlZCB3aXRoIHRoZVxuICAgKiBgZGVmYXVsdEdldFJvd0RhdGFgIGFuZCBgZGVmYXVsdEdldFNlY3Rpb25IZWFkZXJEYXRhYCBmdW5jdGlvbnMuXG4gICAqXG4gICAqIFRoZSBkZWZhdWx0IGV4dHJhY3RvciBleHBlY3RzIGRhdGEgb2Ygb25lIG9mIHRoZSBmb2xsb3dpbmcgZm9ybXM6XG4gICAqXG4gICAqICAgICAgeyBzZWN0aW9uSURfMTogeyByb3dJRF8xOiA8cm93RGF0YTE+LCAuLi4gfSwgLi4uIH1cbiAgICpcbiAgICogICAgb3JcbiAgICpcbiAgICogICAgICB7IHNlY3Rpb25JRF8xOiBbIDxyb3dEYXRhMT4sIDxyb3dEYXRhMj4sIC4uLiBdLCAuLi4gfVxuICAgKlxuICAgKiAgICBvclxuICAgKlxuICAgKiAgICAgIFsgWyA8cm93RGF0YTE+LCA8cm93RGF0YTI+LCAuLi4gXSwgLi4uIF1cbiAgICpcbiAgICogVGhlIGNvbnN0cnVjdG9yIHRha2VzIGluIGEgcGFyYW1zIGFyZ3VtZW50IHRoYXQgY2FuIGNvbnRhaW4gYW55IG9mIHRoZVxuICAgKiBmb2xsb3dpbmc6XG4gICAqXG4gICAqIC0gZ2V0Um93RGF0YShkYXRhQmxvYiwgc2VjdGlvbklELCByb3dJRCk7XG4gICAqIC0gZ2V0U2VjdGlvbkhlYWRlckRhdGEoZGF0YUJsb2IsIHNlY3Rpb25JRCk7XG4gICAqIC0gcm93SGFzQ2hhbmdlZChwcmV2Um93RGF0YSwgbmV4dFJvd0RhdGEpO1xuICAgKiAtIHNlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkKHByZXZTZWN0aW9uRGF0YSwgbmV4dFNlY3Rpb25EYXRhKTtcbiAgICovXG4gIGNvbnN0cnVjdG9yKHBhcmFtczogUGFyYW1UeXBlKSB7XG4gICAgaW52YXJpYW50KFxuICAgICAgcGFyYW1zICYmIHR5cGVvZiBwYXJhbXMucm93SGFzQ2hhbmdlZCA9PT0gJ2Z1bmN0aW9uJyxcbiAgICAgICdNdXN0IHByb3ZpZGUgYSByb3dIYXNDaGFuZ2VkIGZ1bmN0aW9uLicsXG4gICAgKTtcbiAgICB0aGlzLl9yb3dIYXNDaGFuZ2VkID0gcGFyYW1zLnJvd0hhc0NoYW5nZWQ7XG4gICAgdGhpcy5fZ2V0Um93RGF0YSA9IHBhcmFtcy5nZXRSb3dEYXRhIHx8IGRlZmF1bHRHZXRSb3dEYXRhO1xuICAgIHRoaXMuX3NlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkID0gcGFyYW1zLnNlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkO1xuICAgIHRoaXMuX2dldFNlY3Rpb25IZWFkZXJEYXRhID1cbiAgICAgIHBhcmFtcy5nZXRTZWN0aW9uSGVhZGVyRGF0YSB8fCBkZWZhdWx0R2V0U2VjdGlvbkhlYWRlckRhdGE7XG5cbiAgICB0aGlzLl9kYXRhQmxvYiA9IG51bGw7XG4gICAgdGhpcy5fZGlydHlSb3dzID0gW107XG4gICAgdGhpcy5fZGlydHlTZWN0aW9ucyA9IFtdO1xuICAgIHRoaXMuX2NhY2hlZFJvd0NvdW50ID0gMDtcblxuICAgIC8vIFRoZXNlIHR3byBwcml2YXRlIHZhcmlhYmxlcyBhcmUgYWNjZXNzZWQgYnkgb3V0c2lkZXJzIGJlY2F1c2UgTGlzdFZpZXdcbiAgICAvLyB1c2VzIHRoZW0gdG8gaXRlcmF0ZSBvdmVyIHRoZSBkYXRhIGluIHRoaXMgY2xhc3MuXG4gICAgdGhpcy5yb3dJZGVudGl0aWVzID0gW107XG4gICAgdGhpcy5zZWN0aW9uSWRlbnRpdGllcyA9IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIENsb25lcyB0aGlzIGBMaXN0Vmlld0RhdGFTb3VyY2VgIHdpdGggdGhlIHNwZWNpZmllZCBgZGF0YUJsb2JgIGFuZFxuICAgKiBgcm93SWRlbnRpdGllc2AuIFRoZSBgZGF0YUJsb2JgIGlzIGp1c3QgYW4gYXJiaXRyYXJ5IGJsb2Igb2YgZGF0YS4gQXRcbiAgICogY29uc3RydWN0aW9uIGFuIGV4dHJhY3RvciB0byBnZXQgdGhlIGludGVyZXN0aW5nIGluZm9ybWF0aW9uIHdhcyBkZWZpbmVkXG4gICAqIChvciB0aGUgZGVmYXVsdCB3YXMgdXNlZCkuXG4gICAqXG4gICAqIFRoZSBgcm93SWRlbnRpdGllc2AgaXMgYSAyRCBhcnJheSBvZiBpZGVudGlmaWVycyBmb3Igcm93cy5cbiAgICogaWUuIFtbJ2ExJywgJ2EyJ10sIFsnYjEnLCAnYjInLCAnYjMnXSwgLi4uXS4gIElmIG5vdCBwcm92aWRlZCwgaXQnc1xuICAgKiBhc3N1bWVkIHRoYXQgdGhlIGtleXMgb2YgdGhlIHNlY3Rpb24gZGF0YSBhcmUgdGhlIHJvdyBpZGVudGl0aWVzLlxuICAgKlxuICAgKiBOb3RlOiBUaGlzIGZ1bmN0aW9uIGRvZXMgTk9UIGNsb25lIHRoZSBkYXRhIGluIHRoaXMgZGF0YSBzb3VyY2UuIEl0IHNpbXBseVxuICAgKiBwYXNzZXMgdGhlIGZ1bmN0aW9ucyBkZWZpbmVkIGF0IGNvbnN0cnVjdGlvbiB0byBhIG5ldyBkYXRhIHNvdXJjZSB3aXRoXG4gICAqIHRoZSBkYXRhIHNwZWNpZmllZC4gSWYgeW91IHdpc2ggdG8gbWFpbnRhaW4gdGhlIGV4aXN0aW5nIGRhdGEgeW91IG11c3RcbiAgICogaGFuZGxlIG1lcmdpbmcgb2Ygb2xkIGFuZCBuZXcgZGF0YSBzZXBhcmF0ZWx5IGFuZCB0aGVuIHBhc3MgdGhhdCBpbnRvXG4gICAqIHRoaXMgZnVuY3Rpb24gYXMgdGhlIGBkYXRhQmxvYmAuXG4gICAqL1xuICBjbG9uZVdpdGhSb3dzKFxuICAgIGRhdGFCbG9iOiAkUmVhZE9ubHlBcnJheTxhbnk+IHwgeytba2V5OiBzdHJpbmddOiBhbnl9LFxuICAgIHJvd0lkZW50aXRpZXM6ID8kUmVhZE9ubHlBcnJheTxzdHJpbmc+LFxuICApOiBMaXN0Vmlld0RhdGFTb3VyY2Uge1xuICAgIGNvbnN0IHJvd0lkcyA9IHJvd0lkZW50aXRpZXMgPyBbWy4uLnJvd0lkZW50aXRpZXNdXSA6IG51bGw7XG4gICAgaWYgKCF0aGlzLl9zZWN0aW9uSGVhZGVySGFzQ2hhbmdlZCkge1xuICAgICAgdGhpcy5fc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQgPSAoKSA9PiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY2xvbmVXaXRoUm93c0FuZFNlY3Rpb25zKHtzMTogZGF0YUJsb2J9LCBbJ3MxJ10sIHJvd0lkcyk7XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBwZXJmb3JtcyB0aGUgc2FtZSBmdW5jdGlvbiBhcyB0aGUgYGNsb25lV2l0aFJvd3NgIGZ1bmN0aW9uIGJ1dCBoZXJlXG4gICAqIHlvdSBhbHNvIHNwZWNpZnkgd2hhdCB5b3VyIGBzZWN0aW9uSWRlbnRpdGllc2AgYXJlLiBJZiB5b3UgZG9uJ3QgY2FyZVxuICAgKiBhYm91dCBzZWN0aW9ucyB5b3Ugc2hvdWxkIHNhZmVseSBiZSBhYmxlIHRvIHVzZSBgY2xvbmVXaXRoUm93c2AuXG4gICAqXG4gICAqIGBzZWN0aW9uSWRlbnRpdGllc2AgaXMgYW4gYXJyYXkgb2YgaWRlbnRpZmllcnMgZm9yIHNlY3Rpb25zLlxuICAgKiBpZS4gWydzMScsICdzMicsIC4uLl0uICBUaGUgaWRlbnRpZmllcnMgc2hvdWxkIGNvcnJlc3BvbmQgdG8gdGhlIGtleXMgb3IgYXJyYXkgaW5kZXhlc1xuICAgKiBvZiB0aGUgZGF0YSB5b3Ugd2lzaCB0byBpbmNsdWRlLiAgSWYgbm90IHByb3ZpZGVkLCBpdCdzIGFzc3VtZWQgdGhhdCB0aGVcbiAgICoga2V5cyBvZiBkYXRhQmxvYiBhcmUgdGhlIHNlY3Rpb24gaWRlbnRpdGllcy5cbiAgICpcbiAgICogTm90ZTogdGhpcyByZXR1cm5zIGEgbmV3IG9iamVjdCFcbiAgICpcbiAgICogYGBgXG4gICAqIGNvbnN0IGRhdGFTb3VyY2UgPSBkcy5jbG9uZVdpdGhSb3dzQW5kU2VjdGlvbnMoe1xuICAgKiAgIGFkZHJlc3NlczogWydyb3cgMScsICdyb3cgMiddLFxuICAgKiAgIHBob25lX251bWJlcnM6IFsnZGF0YSAxJywgJ2RhdGEgMiddLFxuICAgKiB9LCBbJ3Bob25lX251bWJlcnMnXSk7XG4gICAqIGBgYFxuICAgKi9cbiAgY2xvbmVXaXRoUm93c0FuZFNlY3Rpb25zKFxuICAgIGRhdGFCbG9iOiBhbnksXG4gICAgc2VjdGlvbklkZW50aXRpZXM6ID9BcnJheTxzdHJpbmc+LFxuICAgIHJvd0lkZW50aXRpZXM6ID9BcnJheTxBcnJheTxzdHJpbmc+PixcbiAgKTogTGlzdFZpZXdEYXRhU291cmNlIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICB0eXBlb2YgdGhpcy5fc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQgPT09ICdmdW5jdGlvbicsXG4gICAgICAnTXVzdCBwcm92aWRlIGEgc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQgZnVuY3Rpb24gd2l0aCBzZWN0aW9uIGRhdGEuJyxcbiAgICApO1xuICAgIGludmFyaWFudChcbiAgICAgICFzZWN0aW9uSWRlbnRpdGllcyB8fFxuICAgICAgICAhcm93SWRlbnRpdGllcyB8fFxuICAgICAgICBzZWN0aW9uSWRlbnRpdGllcy5sZW5ndGggPT09IHJvd0lkZW50aXRpZXMubGVuZ3RoLFxuICAgICAgJ3JvdyBhbmQgc2VjdGlvbiBpZHMgbGVuZ3RocyBtdXN0IGJlIHRoZSBzYW1lJyxcbiAgICApO1xuXG4gICAgY29uc3QgbmV3U291cmNlID0gbmV3IExpc3RWaWV3RGF0YVNvdXJjZSh7XG4gICAgICBnZXRSb3dEYXRhOiB0aGlzLl9nZXRSb3dEYXRhLFxuICAgICAgZ2V0U2VjdGlvbkhlYWRlckRhdGE6IHRoaXMuX2dldFNlY3Rpb25IZWFkZXJEYXRhLFxuICAgICAgcm93SGFzQ2hhbmdlZDogdGhpcy5fcm93SGFzQ2hhbmdlZCxcbiAgICAgIHNlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkOiB0aGlzLl9zZWN0aW9uSGVhZGVySGFzQ2hhbmdlZCxcbiAgICB9KTtcbiAgICBuZXdTb3VyY2UuX2RhdGFCbG9iID0gZGF0YUJsb2I7XG4gICAgaWYgKHNlY3Rpb25JZGVudGl0aWVzKSB7XG4gICAgICBuZXdTb3VyY2Uuc2VjdGlvbklkZW50aXRpZXMgPSBzZWN0aW9uSWRlbnRpdGllcztcbiAgICB9IGVsc2Uge1xuICAgICAgbmV3U291cmNlLnNlY3Rpb25JZGVudGl0aWVzID0gT2JqZWN0LmtleXMoZGF0YUJsb2IpO1xuICAgIH1cbiAgICBpZiAocm93SWRlbnRpdGllcykge1xuICAgICAgbmV3U291cmNlLnJvd0lkZW50aXRpZXMgPSByb3dJZGVudGl0aWVzO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXdTb3VyY2Uucm93SWRlbnRpdGllcyA9IFtdO1xuICAgICAgbmV3U291cmNlLnNlY3Rpb25JZGVudGl0aWVzLmZvckVhY2goc2VjdGlvbklEID0+IHtcbiAgICAgICAgbmV3U291cmNlLnJvd0lkZW50aXRpZXMucHVzaChPYmplY3Qua2V5cyhkYXRhQmxvYltzZWN0aW9uSURdKSk7XG4gICAgICB9KTtcbiAgICB9XG4gICAgbmV3U291cmNlLl9jYWNoZWRSb3dDb3VudCA9IGNvdW50Um93cyhuZXdTb3VyY2Uucm93SWRlbnRpdGllcyk7XG5cbiAgICBuZXdTb3VyY2UuX2NhbGN1bGF0ZURpcnR5QXJyYXlzKFxuICAgICAgdGhpcy5fZGF0YUJsb2IsXG4gICAgICB0aGlzLnNlY3Rpb25JZGVudGl0aWVzLFxuICAgICAgdGhpcy5yb3dJZGVudGl0aWVzLFxuICAgICk7XG5cbiAgICByZXR1cm4gbmV3U291cmNlO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiByb3dzIGluIHRoZSBkYXRhIHNvdXJjZS5cbiAgICpcbiAgICogSWYgeW91IGFyZSBzcGVjaWZ5aW5nIHRoZSByb3dJZGVudGl0aWVzIG9yIHNlY3Rpb25JZGVudGl0aWVzLCB0aGVuIGBnZXRSb3dDb3VudGAgd2lsbCByZXR1cm4gdGhlIG51bWJlciBvZiByb3dzIGluIHRoZSBmaWx0ZXJlZCBkYXRhIHNvdXJjZS5cbiAgICovXG4gIGdldFJvd0NvdW50KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuX2NhY2hlZFJvd0NvdW50O1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiByb3dzIGluIHRoZSBkYXRhIHNvdXJjZSAoc2VlIGBnZXRSb3dDb3VudGAgZm9yIGhvdyB0aGlzIGlzIGNhbGN1bGF0ZWQpIHBsdXMgdGhlIG51bWJlciBvZiBzZWN0aW9ucyBpbiB0aGUgZGF0YS5cbiAgICpcbiAgICogSWYgeW91IGFyZSBzcGVjaWZ5aW5nIHRoZSByb3dJZGVudGl0aWVzIG9yIHNlY3Rpb25JZGVudGl0aWVzLCB0aGVuIGBnZXRSb3dBbmRTZWN0aW9uQ291bnRgIHdpbGwgcmV0dXJuIHRoZSBudW1iZXIgb2Ygcm93cyAmIHNlY3Rpb25zIGluIHRoZSBmaWx0ZXJlZCBkYXRhIHNvdXJjZS5cbiAgICovXG4gIGdldFJvd0FuZFNlY3Rpb25Db3VudCgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLl9jYWNoZWRSb3dDb3VudCArIHRoaXMuc2VjdGlvbklkZW50aXRpZXMubGVuZ3RoO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgaWYgdGhlIHJvdyBpcyBkaXJ0aWVkIGFuZCBuZWVkcyB0byBiZSByZXJlbmRlcmVkXG4gICAqL1xuICByb3dTaG91bGRVcGRhdGUoc2VjdGlvbkluZGV4OiBudW1iZXIsIHJvd0luZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICBjb25zdCBuZWVkc1VwZGF0ZSA9IHRoaXMuX2RpcnR5Um93c1tzZWN0aW9uSW5kZXhdW3Jvd0luZGV4XTtcbiAgICB3YXJuaW5nKFxuICAgICAgbmVlZHNVcGRhdGUgIT09IHVuZGVmaW5lZCxcbiAgICAgICdtaXNzaW5nIGRpcnR5Qml0IGZvciBzZWN0aW9uLCByb3c6ICcgKyBzZWN0aW9uSW5kZXggKyAnLCAnICsgcm93SW5kZXgsXG4gICAgKTtcbiAgICByZXR1cm4gbmVlZHNVcGRhdGU7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgZGF0YSByZXF1aXJlZCB0byByZW5kZXIgdGhlIHJvdy5cbiAgICovXG4gIGdldFJvd0RhdGEoc2VjdGlvbkluZGV4OiBudW1iZXIsIHJvd0luZGV4OiBudW1iZXIpOiBhbnkge1xuICAgIGNvbnN0IHNlY3Rpb25JRCA9IHRoaXMuc2VjdGlvbklkZW50aXRpZXNbc2VjdGlvbkluZGV4XTtcbiAgICBjb25zdCByb3dJRCA9IHRoaXMucm93SWRlbnRpdGllc1tzZWN0aW9uSW5kZXhdW3Jvd0luZGV4XTtcbiAgICB3YXJuaW5nKFxuICAgICAgc2VjdGlvbklEICE9PSB1bmRlZmluZWQgJiYgcm93SUQgIT09IHVuZGVmaW5lZCxcbiAgICAgICdyZW5kZXJpbmcgaW52YWxpZCBzZWN0aW9uLCByb3c6ICcgKyBzZWN0aW9uSW5kZXggKyAnLCAnICsgcm93SW5kZXgsXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5fZ2V0Um93RGF0YSh0aGlzLl9kYXRhQmxvYiwgc2VjdGlvbklELCByb3dJRCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgcm93SUQgYXQgaW5kZXggcHJvdmlkZWQgaWYgdGhlIGRhdGFTb3VyY2UgYXJyYXlzIHdlcmUgZmxhdHRlbmVkLFxuICAgKiBvciBudWxsIG9mIG91dCBvZiByYW5nZSBpbmRleGVzLlxuICAgKi9cbiAgZ2V0Um93SURGb3JGbGF0SW5kZXgoaW5kZXg6IG51bWJlcik6ID9zdHJpbmcge1xuICAgIGxldCBhY2Nlc3NJbmRleCA9IGluZGV4O1xuICAgIGZvciAobGV0IGlpID0gMDsgaWkgPCB0aGlzLnNlY3Rpb25JZGVudGl0aWVzLmxlbmd0aDsgaWkrKykge1xuICAgICAgaWYgKGFjY2Vzc0luZGV4ID49IHRoaXMucm93SWRlbnRpdGllc1tpaV0ubGVuZ3RoKSB7XG4gICAgICAgIGFjY2Vzc0luZGV4IC09IHRoaXMucm93SWRlbnRpdGllc1tpaV0ubGVuZ3RoO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm93SWRlbnRpdGllc1tpaV1bYWNjZXNzSW5kZXhdO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBzZWN0aW9uSUQgYXQgaW5kZXggcHJvdmlkZWQgaWYgdGhlIGRhdGFTb3VyY2UgYXJyYXlzIHdlcmUgZmxhdHRlbmVkLFxuICAgKiBvciBudWxsIGZvciBvdXQgb2YgcmFuZ2UgaW5kZXhlcy5cbiAgICovXG4gIGdldFNlY3Rpb25JREZvckZsYXRJbmRleChpbmRleDogbnVtYmVyKTogP3N0cmluZyB7XG4gICAgbGV0IGFjY2Vzc0luZGV4ID0gaW5kZXg7XG4gICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IHRoaXMuc2VjdGlvbklkZW50aXRpZXMubGVuZ3RoOyBpaSsrKSB7XG4gICAgICBpZiAoYWNjZXNzSW5kZXggPj0gdGhpcy5yb3dJZGVudGl0aWVzW2lpXS5sZW5ndGgpIHtcbiAgICAgICAgYWNjZXNzSW5kZXggLT0gdGhpcy5yb3dJZGVudGl0aWVzW2lpXS5sZW5ndGg7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWN0aW9uSWRlbnRpdGllc1tpaV07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gYXJyYXkgY29udGFpbmluZyB0aGUgbnVtYmVyIG9mIHJvd3MgaW4gZWFjaCBzZWN0aW9uXG4gICAqL1xuICBnZXRTZWN0aW9uTGVuZ3RocygpOiBBcnJheTxudW1iZXI+IHtcbiAgICBjb25zdCByZXN1bHRzID0gW107XG4gICAgZm9yIChsZXQgaWkgPSAwOyBpaSA8IHRoaXMuc2VjdGlvbklkZW50aXRpZXMubGVuZ3RoOyBpaSsrKSB7XG4gICAgICByZXN1bHRzLnB1c2godGhpcy5yb3dJZGVudGl0aWVzW2lpXS5sZW5ndGgpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGlmIHRoZSBzZWN0aW9uIGhlYWRlciBpcyBkaXJ0aWVkIGFuZCBuZWVkcyB0byBiZSByZXJlbmRlcmVkXG4gICAqL1xuICBzZWN0aW9uSGVhZGVyU2hvdWxkVXBkYXRlKHNlY3Rpb25JbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgY29uc3QgbmVlZHNVcGRhdGUgPSB0aGlzLl9kaXJ0eVNlY3Rpb25zW3NlY3Rpb25JbmRleF07XG4gICAgd2FybmluZyhcbiAgICAgIG5lZWRzVXBkYXRlICE9PSB1bmRlZmluZWQsXG4gICAgICAnbWlzc2luZyBkaXJ0eUJpdCBmb3Igc2VjdGlvbjogJyArIHNlY3Rpb25JbmRleCxcbiAgICApO1xuICAgIHJldHVybiBuZWVkc1VwZGF0ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBkYXRhIHJlcXVpcmVkIHRvIHJlbmRlciB0aGUgc2VjdGlvbiBoZWFkZXJcbiAgICovXG4gIGdldFNlY3Rpb25IZWFkZXJEYXRhKHNlY3Rpb25JbmRleDogbnVtYmVyKTogYW55IHtcbiAgICBpZiAoIXRoaXMuX2dldFNlY3Rpb25IZWFkZXJEYXRhKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgY29uc3Qgc2VjdGlvbklEID0gdGhpcy5zZWN0aW9uSWRlbnRpdGllc1tzZWN0aW9uSW5kZXhdO1xuICAgIHdhcm5pbmcoXG4gICAgICBzZWN0aW9uSUQgIT09IHVuZGVmaW5lZCxcbiAgICAgICdyZW5kZXJTZWN0aW9uIGNhbGxlZCBvbiBpbnZhbGlkIHNlY3Rpb246ICcgKyBzZWN0aW9uSW5kZXgsXG4gICAgKTtcbiAgICByZXR1cm4gdGhpcy5fZ2V0U2VjdGlvbkhlYWRlckRhdGEodGhpcy5fZGF0YUJsb2IsIHNlY3Rpb25JRCk7XG4gIH1cblxuICAvKipcbiAgICogUHJpdmF0ZSBtZW1iZXJzIGFuZCBtZXRob2RzLlxuICAgKi9cblxuICBfZ2V0Um93RGF0YTogdHlwZW9mIGRlZmF1bHRHZXRSb3dEYXRhO1xuICBfZ2V0U2VjdGlvbkhlYWRlckRhdGE6IHR5cGVvZiBkZWZhdWx0R2V0U2VjdGlvbkhlYWRlckRhdGE7XG4gIF9yb3dIYXNDaGFuZ2VkOiBkaWZmZXJUeXBlO1xuICBfc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQ6ID9kaWZmZXJUeXBlO1xuXG4gIF9kYXRhQmxvYjogYW55O1xuICBfZGlydHlSb3dzOiBBcnJheTxBcnJheTxib29sZWFuPj47XG4gIF9kaXJ0eVNlY3Rpb25zOiBBcnJheTxib29sZWFuPjtcbiAgX2NhY2hlZFJvd0NvdW50OiBudW1iZXI7XG5cbiAgLy8gVGhlc2UgdHdvICdwcm90ZWN0ZWQnIHZhcmlhYmxlcyBhcmUgYWNjZXNzZWQgYnkgTGlzdFZpZXcgdG8gaXRlcmF0ZSBvdmVyXG4gIC8vIHRoZSBkYXRhIGluIHRoaXMgY2xhc3MuXG4gIHJvd0lkZW50aXRpZXM6IEFycmF5PEFycmF5PHN0cmluZz4+O1xuICBzZWN0aW9uSWRlbnRpdGllczogQXJyYXk8c3RyaW5nPjtcblxuICBfY2FsY3VsYXRlRGlydHlBcnJheXMoXG4gICAgcHJldkRhdGFCbG9iOiBhbnksXG4gICAgcHJldlNlY3Rpb25JRHM6IEFycmF5PHN0cmluZz4sXG4gICAgcHJldlJvd0lEczogQXJyYXk8QXJyYXk8c3RyaW5nPj4sXG4gICk6IHZvaWQge1xuICAgIC8vIGNvbnN0cnVjdCBhIGhhc2htYXAgb2YgdGhlIGV4aXN0aW5nIChvbGQpIGlkIGFycmF5c1xuICAgIGNvbnN0IHByZXZTZWN0aW9uc0hhc2ggPSBrZXllZERpY3Rpb25hcnlGcm9tQXJyYXkocHJldlNlY3Rpb25JRHMpO1xuICAgIGNvbnN0IHByZXZSb3dzSGFzaCA9IHt9O1xuICAgIGZvciAobGV0IGlpID0gMDsgaWkgPCBwcmV2Um93SURzLmxlbmd0aDsgaWkrKykge1xuICAgICAgdmFyIHNlY3Rpb25JRCA9IHByZXZTZWN0aW9uSURzW2lpXTtcbiAgICAgIHdhcm5pbmcoXG4gICAgICAgICFwcmV2Um93c0hhc2hbc2VjdGlvbklEXSxcbiAgICAgICAgJ1NlY3Rpb25JRCBhcHBlYXJzIG1vcmUgdGhhbiBvbmNlOiAnICsgc2VjdGlvbklELFxuICAgICAgKTtcbiAgICAgIHByZXZSb3dzSGFzaFtzZWN0aW9uSURdID0ga2V5ZWREaWN0aW9uYXJ5RnJvbUFycmF5KHByZXZSb3dJRHNbaWldKTtcbiAgICB9XG5cbiAgICAvLyBjb21wYXJlIHRoZSAyIGlkZW50aXR5IGFycmF5IGFuZCBnZXQgdGhlIGRpcnRpZWQgcm93c1xuICAgIHRoaXMuX2RpcnR5U2VjdGlvbnMgPSBbXTtcbiAgICB0aGlzLl9kaXJ0eVJvd3MgPSBbXTtcblxuICAgIGxldCBkaXJ0eTtcbiAgICBmb3IgKGxldCBzSW5kZXggPSAwOyBzSW5kZXggPCB0aGlzLnNlY3Rpb25JZGVudGl0aWVzLmxlbmd0aDsgc0luZGV4KyspIHtcbiAgICAgIHZhciBzZWN0aW9uSUQgPSB0aGlzLnNlY3Rpb25JZGVudGl0aWVzW3NJbmRleF07XG4gICAgICAvLyBkaXJ0eSBpZiB0aGUgc2VjdGlvbkhlYWRlciBpcyBuZXcgb3IgX3NlY3Rpb25IYXNDaGFuZ2VkIGlzIHRydWVcbiAgICAgIGRpcnR5ID0gIXByZXZTZWN0aW9uc0hhc2hbc2VjdGlvbklEXTtcbiAgICAgIGNvbnN0IHNlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkID0gdGhpcy5fc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQ7XG4gICAgICBpZiAoIWRpcnR5ICYmIHNlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkKSB7XG4gICAgICAgIGRpcnR5ID0gc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQoXG4gICAgICAgICAgdGhpcy5fZ2V0U2VjdGlvbkhlYWRlckRhdGEocHJldkRhdGFCbG9iLCBzZWN0aW9uSUQpLFxuICAgICAgICAgIHRoaXMuX2dldFNlY3Rpb25IZWFkZXJEYXRhKHRoaXMuX2RhdGFCbG9iLCBzZWN0aW9uSUQpLFxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgdGhpcy5fZGlydHlTZWN0aW9ucy5wdXNoKCEhZGlydHkpO1xuXG4gICAgICB0aGlzLl9kaXJ0eVJvd3Nbc0luZGV4XSA9IFtdO1xuICAgICAgZm9yIChcbiAgICAgICAgbGV0IHJJbmRleCA9IDA7XG4gICAgICAgIHJJbmRleCA8IHRoaXMucm93SWRlbnRpdGllc1tzSW5kZXhdLmxlbmd0aDtcbiAgICAgICAgckluZGV4KytcbiAgICAgICkge1xuICAgICAgICBjb25zdCByb3dJRCA9IHRoaXMucm93SWRlbnRpdGllc1tzSW5kZXhdW3JJbmRleF07XG4gICAgICAgIC8vIGRpcnR5IGlmIHRoZSBzZWN0aW9uIGlzIG5ldywgcm93IGlzIG5ldyBvciBfcm93SGFzQ2hhbmdlZCBpcyB0cnVlXG4gICAgICAgIGRpcnR5ID1cbiAgICAgICAgICAhcHJldlNlY3Rpb25zSGFzaFtzZWN0aW9uSURdIHx8XG4gICAgICAgICAgIXByZXZSb3dzSGFzaFtzZWN0aW9uSURdW3Jvd0lEXSB8fFxuICAgICAgICAgIHRoaXMuX3Jvd0hhc0NoYW5nZWQoXG4gICAgICAgICAgICB0aGlzLl9nZXRSb3dEYXRhKHByZXZEYXRhQmxvYiwgc2VjdGlvbklELCByb3dJRCksXG4gICAgICAgICAgICB0aGlzLl9nZXRSb3dEYXRhKHRoaXMuX2RhdGFCbG9iLCBzZWN0aW9uSUQsIHJvd0lEKSxcbiAgICAgICAgICApO1xuICAgICAgICB0aGlzLl9kaXJ0eVJvd3Nbc0luZGV4XS5wdXNoKCEhZGlydHkpO1xuICAgICAgfVxuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBjb3VudFJvd3MoYWxsUm93SURzKSB7XG4gIGxldCB0b3RhbFJvd3MgPSAwO1xuICBmb3IgKGxldCBzZWN0aW9uSWR4ID0gMDsgc2VjdGlvbklkeCA8IGFsbFJvd0lEcy5sZW5ndGg7IHNlY3Rpb25JZHgrKykge1xuICAgIGNvbnN0IHJvd0lEcyA9IGFsbFJvd0lEc1tzZWN0aW9uSWR4XTtcbiAgICB0b3RhbFJvd3MgKz0gcm93SURzLmxlbmd0aDtcbiAgfVxuICByZXR1cm4gdG90YWxSb3dzO1xufVxuXG5mdW5jdGlvbiBrZXllZERpY3Rpb25hcnlGcm9tQXJyYXkoYXJyKSB7XG4gIGlmIChpc0VtcHR5KGFycikpIHtcbiAgICByZXR1cm4ge307XG4gIH1cbiAgY29uc3QgcmVzdWx0ID0ge307XG4gIGZvciAobGV0IGlpID0gMDsgaWkgPCBhcnIubGVuZ3RoOyBpaSsrKSB7XG4gICAgY29uc3Qga2V5ID0gYXJyW2lpXTtcbiAgICB3YXJuaW5nKCFyZXN1bHRba2V5XSwgJ1ZhbHVlIGFwcGVhcnMgbW9yZSB0aGFuIG9uY2UgaW4gYXJyYXk6ICcgKyBrZXkpO1xuICAgIHJlc3VsdFtrZXldID0gdHJ1ZTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IExpc3RWaWV3RGF0YVNvdXJjZTtcbiJdfQ==